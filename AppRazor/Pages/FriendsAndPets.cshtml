@page
@model AppRazor.Pages.FriendsAndPets
@{
    ViewData["Title"] = "Friends and Pets by Country";
}

<div class="container">
    <h1>Friends and Pets</h1>

    @if (!string.IsNullOrEmpty(Model.Message))
    {
        <div class="alert alert-danger">@Model.Message</div>
    }

    @* För att kunna välja specifikt land via en dropdown-meny *@
    <form method="get" class="mb-4">
        <label class="form-label">Select country</label>
        <select name="SelectedCountry" class="form-select" onchange="this.form.submit()">

            <option value="">-- All countries --</option>

            @foreach (var country in Model.Countries)
            {
                <option value="@country" selected="@(country == Model.SelectedCountry)">
                    @country
                </option>
            }
        </select>
    </form>

    <!-- Visa land -> stad -> vänner -> husdjur -->
    @foreach (var countryGroup in Model.Friends.GroupBy(f => f.Address.Country))
    {
        <h2 class="mt-5">
            @countryGroup.Key
            <span class="badge bg-primary">@countryGroup.Count()</span>
        </h2>

        @foreach (var cityGroup in countryGroup.GroupBy(f => f.Address.City))
        {
            <h4 class="mt-3">
                @cityGroup.Key
                <span class="badge bg-secondary">@cityGroup.Count()</span>
            </h4>

            <table class="table table-striped mb-4">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Pets</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var friend in cityGroup)
                    {
                        <tr>
                            <td>@friend.FirstName @friend.LastName</td>
                            <td>@friend.Email</td>
                            <td>
                                <ul class="mb-0">
                                    @foreach (var pet in friend.Pets)
                                    {
                                        <li>@pet.Name (@pet.Kind)</li>
                                    }
                                </ul>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    }

    @if (!Model.Friends.Any())
    {
        <p>No friends with pets were found.</p>
    }
</div>